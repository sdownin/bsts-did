intpd = intpd, ## intervention after first section
ystart = 0,
effect.types = effect.types,
# benchmark.type = 'self', ## 'all', 'self'
# treat.rule = 'below.benchmark',
treat.rule = 'below.benchmark',
treat.prob = 1, #0.95,  ## 0.6
treat.threshold = 1/2,  # 0.015
sim.id = sim.id, ## defaults to timestamp
##
b4 = sim$b4, ## past performance
b5 = sim$b5, ## growth (linear function of time t)
## Dynamic treatment effect function parameters
w0 = 1.7,  ## constant
w1 = 0.18,  ## linear
w2 = -0.005,  ## quadratic
## TODO: CHECK w2.shift SENSITIVITY - this shifts quadratic curve several periods to the right so that treatment effect increases slowly
w2.shift = -round(.2*intpd),  ## optimal value here is likely a function of the combination of treatment effect function parameters
## Plotting
plot.show=F, ## TRUE
plot.save=F  ## TRUE
)
}
## Save simulation list as serialized data file
simlist.file <- sprintf('single_intervention_SIMLIST_%s.rds', simlist[[1]]$sim$id)
saveRDS(simlist, file = file.path(dir_plot, simlist.file))
##====================
##  DEBUG
##--------------
View(simlist$`3.mi.perf.lo.gro`$sim$df)
library(tibble)
library(did)
# library(dplyr)
simdf <- simlist$`1.no.perf.no.gro`$sim$df
simdf <- simdf[which(simdf$effect.type=='geometric'), ]
## Set group name 'gname' field, where 0 = control, # = period of treatment
simdf$gname <- 0
simdf$gname[simdf$group=='treatment'] <- simdf$match_pd[simdf$group=='treatment']
ccattgt <- att_gt(yname = "y", ## "Y",
tname = "t",
idname = "actor",
gname = "gname",
xformla = ~c1 + c2 + c3,
data = simdf #,
# panel = F
)
ccattgt
agg.simple <- aggte(ccattgt, type='simple')
summary(agg.simple)
## DYNAMIC EFFECTS AND EVENT STUDIES
agg.es <- aggte(ccattgt, type = "dynamic")
summary(agg.es)
ggdid(agg.es)
## Correlation of simulated to inferred
cor(cbind(simdf$b3[simdf$actor==1][-1], agg.es$att.egt))
## MATPLOT of
matplot(cbind(simdf$b3[simdf$actor==60][-1], agg.es$att.egt), type='o',pch=1:2)
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd-1)]))
intpd
intpd - 1
## Run Simulation List
sim.id <- round(as.numeric(Sys.time()))
for (i in 1:length(simlist)) {
key <- names(simlist)[i]
sim <- simlist[[key]]
cat(sprintf('\nScenario label: %s\n\n', key))
# cat(str(simlist[[key]]))
simlist[[key]]$sim <- runSimSingleInterventionEffectComparison(
n = n, ## NUMBER OF FIRMS
npds = npds, ## NUMBER OF PERIODS
intpd = intpd, ## intervention after first section
ystart = 0,
effect.types = effect.types,
# benchmark.type = 'self', ## 'all', 'self'
# treat.rule = 'below.benchmark',
treat.rule = 'below.benchmark',
treat.prob = 1, #0.95,  ## 0.6
treat.threshold = 1/2,  # 0.015
sim.id = sim.id, ## defaults to timestamp
##
b4 = sim$b4, ## past performance
b5 = sim$b5, ## growth (linear function of time t)
## Dynamic treatment effect function parameters
w0 = 1.7,  ## constant
w1 = 0.18,  ## linear
w2 = -0.005,  ## quadratic
## TODO: CHECK w2.shift SENSITIVITY - this shifts quadratic curve several periods to the right so that treatment effect increases slowly
w2.shift = -round(.2*intpd),  ## optimal value here is likely a function of the combination of treatment effect function parameters
## Plotting
plot.show=F, ## TRUE
plot.save=F  ## TRUE
)
}
## Save simulation list as serialized data file
simlist.file <- sprintf('single_intervention_SIMLIST_%s.rds', simlist[[1]]$sim$id)
saveRDS(simlist, file = file.path(dir_plot, simlist.file))
##====================
##  DEBUG
##--------------
View(simlist$`3.mi.perf.lo.gro`$sim$df)
library(tibble)
library(did)
# library(dplyr)
simdf <- simlist$`1.no.perf.no.gro`$sim$df
simdf <- simdf[which(simdf$effect.type=='geometric'), ]
## Set group name 'gname' field, where 0 = control, # = period of treatment
simdf$gname <- 0
simdf$gname[simdf$group=='treatment'] <- simdf$match_pd[simdf$group=='treatment']
ccattgt <- att_gt(yname = "y", ## "Y",
tname = "t",
idname = "actor",
gname = "gname",
xformla = ~c1 + c2 + c3,
data = simdf #,
# panel = F
)
ccattgt
agg.simple <- aggte(ccattgt, type='simple')
summary(agg.simple)
## DYNAMIC EFFECTS AND EVENT STUDIES
agg.es <- aggte(ccattgt, type = "dynamic")
summary(agg.es)
ggdid(agg.es)
## Correlation of simulated to inferred
cor(cbind(simdf$b3[simdf$actor==1][-1], agg.es$att.egt))
## MATPLOT of
matplot(cbind(simdf$b3[simdf$actor==60][-1], agg.es$att.egt), type='o',pch=1:2)
cor(cbind(simdf$x1[simdf$t==intpd-1], simdf$y[simdf$t==(intpd-2)]))
cor(cbind(simdf$x1[simdf$t==intpd+1], simdf$y[simdf$t==(intpd)]))
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd-1)]))
# library(dplyr)
simdf <- simlist$`1.no.perf.no.gro`$sim$df
simdf <- simdf[which(simdf$effect.type=='quadratic'), ]
## Set group name 'gname' field, where 0 = control, # = period of treatment
simdf$gname <- 0
simdf$gname[simdf$group=='treatment'] <- simdf$match_pd[simdf$group=='treatment']
ccattgt <- att_gt(yname = "y", ## "Y",
tname = "t",
idname = "actor",
gname = "gname",
xformla = ~c1 + c2 + c3,
data = simdf #,
# panel = F
)
ccattgt
agg.simple <- aggte(ccattgt, type='simple')
summary(agg.simple)
## DYNAMIC EFFECTS AND EVENT STUDIES
agg.es <- aggte(ccattgt, type = "dynamic")
summary(agg.es)
ggdid(agg.es)
## Correlation of simulated to inferred
cor(cbind(simdf$b3[simdf$actor==1][-1], agg.es$att.egt))
## MATPLOT of
matplot(cbind(simdf$b3[simdf$actor==60][-1], agg.es$att.egt), type='o',pch=1:2)
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd-1)]))
cor(cbind(simdf$x1[simdf$t==intpd+1], simdf$y[simdf$t==(intpd)]))
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd-1)]))
cor(cbind(simdf$x1[simdf$t==intpd-1], simdf$y[simdf$t==(intpd-2)]))
cor(cbind(simdf$x1[simdf$t==intpd+2], simdf$y[simdf$t==(intpd+1)]))
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd)]))
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd-1)]))
## Run Simulation List
sim.id <- round(as.numeric(Sys.time()))
for (i in 1:length(simlist)) {
key <- names(simlist)[i]
sim <- simlist[[key]]
cat(sprintf('\nScenario label: %s\n\n', key))
# cat(str(simlist[[key]]))
simlist[[key]]$sim <- runSimSingleInterventionEffectComparison(
n = n, ## NUMBER OF FIRMS
npds = npds, ## NUMBER OF PERIODS
intpd = intpd, ## intervention after first section
ystart = 0,
effect.types = effect.types,
# benchmark.type = 'self', ## 'all', 'self'
treat.rule = 'random',
# treat.rule = 'below.benchmark',
treat.prob = .5, #0.95,  ## 0.6
# treat.threshold = 1/2,  # 0.015
sim.id = sim.id, ## defaults to timestamp
##
b4 = sim$b4, ## past performance
b5 = sim$b5, ## growth (linear function of time t)
## Dynamic treatment effect function parameters
w0 = 1.7,  ## constant
w1 = 0.18,  ## linear
w2 = -0.005,  ## quadratic
## TODO: CHECK w2.shift SENSITIVITY - this shifts quadratic curve several periods to the right so that treatment effect increases slowly
w2.shift = -round(.2*intpd),  ## optimal value here is likely a function of the combination of treatment effect function parameters
## Plotting
plot.show=F, ## TRUE
plot.save=F  ## TRUE
)
}
## Save simulation list as serialized data file
simlist.file <- sprintf('single_intervention_SIMLIST_%s.rds', simlist[[1]]$sim$id)
saveRDS(simlist, file = file.path(dir_plot, simlist.file))
##====================
##  DEBUG
##--------------
View(simlist$`3.mi.perf.lo.gro`$sim$df)
library(tibble)
library(did)
# library(dplyr)
simdf <- simlist$`1.no.perf.no.gro`$sim$df
simdf <- simdf[which(simdf$effect.type=='quadratic'), ]
## Set group name 'gname' field, where 0 = control, # = period of treatment
simdf$gname <- 0
simdf$gname[simdf$group=='treatment'] <- simdf$match_pd[simdf$group=='treatment']
ccattgt <- att_gt(yname = "y", ## "Y",
tname = "t",
idname = "actor",
gname = "gname",
xformla = ~c1 + c2 + c3,
data = simdf #,
# panel = F
)
ccattgt
agg.simple <- aggte(ccattgt, type='simple')
summary(agg.simple)
## DYNAMIC EFFECTS AND EVENT STUDIES
agg.es <- aggte(ccattgt, type = "dynamic")
summary(agg.es)
ggdid(agg.es)
## Correlation of simulated to inferred
cor(cbind(simdf$b3[simdf$actor==1][-1], agg.es$att.egt))
## MATPLOT of
matplot(cbind(simdf$b3[simdf$actor==60][-1], agg.es$att.egt), type='o',pch=1:2)
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd-1)]))
cor(cbind(simdf$x1[simdf$t==intpd-1], simdf$y[simdf$t==(intpd-0)]))
cor(cbind(simdf$x1[simdf$t==intpd-1], simdf$y[simdf$t==(intpd+1)]))
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd+1)]))
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd-1)]))
## Run Simulation List
sim.id <- round(as.numeric(Sys.time()))
for (i in 1:length(simlist)) {
key <- names(simlist)[i]
sim <- simlist[[key]]
cat(sprintf('\nScenario label: %s\n\n', key))
# cat(str(simlist[[key]]))
simlist[[key]]$sim <- runSimSingleInterventionEffectComparison(
n = n, ## NUMBER OF FIRMS
npds = npds, ## NUMBER OF PERIODS
intpd = intpd, ## intervention after first section
ystart = 0,
effect.types = effect.types,
# benchmark.type = 'self', ## 'all', 'self'
# treat.rule = 'random',
treat.rule = 'below.benchmark',
treat.prob = .95, #0.95,  ## 0.6
treat.threshold = 1/3,  # 0.015
sim.id = sim.id, ## defaults to timestamp
##
b4 = sim$b4, ## past performance
b5 = sim$b5, ## growth (linear function of time t)
## Dynamic treatment effect function parameters
w0 = 1.7,  ## constant
w1 = 0.18,  ## linear
w2 = -0.005,  ## quadratic
## TODO: CHECK w2.shift SENSITIVITY - this shifts quadratic curve several periods to the right so that treatment effect increases slowly
w2.shift = -round(.2*intpd),  ## optimal value here is likely a function of the combination of treatment effect function parameters
## Plotting
plot.show=F, ## TRUE
plot.save=F  ## TRUE
)
}
## Save simulation list as serialized data file
simlist.file <- sprintf('single_intervention_SIMLIST_%s.rds', simlist[[1]]$sim$id)
saveRDS(simlist, file = file.path(dir_plot, simlist.file))
##====================
##  DEBUG
##--------------
View(simlist$`3.mi.perf.lo.gro`$sim$df)
library(tibble)
library(did)
# library(dplyr)
simdf <- simlist$`1.no.perf.no.gro`$sim$df
simdf <- simdf[which(simdf$effect.type=='quadratic'), ]
## Set group name 'gname' field, where 0 = control, # = period of treatment
simdf$gname <- 0
simdf$gname[simdf$group=='treatment'] <- simdf$match_pd[simdf$group=='treatment']
ccattgt <- att_gt(yname = "y", ## "Y",
tname = "t",
idname = "actor",
gname = "gname",
xformla = ~c1 + c2 + c3,
data = simdf #,
# panel = F
)
ccattgt
agg.simple <- aggte(ccattgt, type='simple')
summary(agg.simple)
## DYNAMIC EFFECTS AND EVENT STUDIES
agg.es <- aggte(ccattgt, type = "dynamic")
summary(agg.es)
ggdid(agg.es)
## Correlation of simulated to inferred
cor(cbind(simdf$b3[simdf$actor==1][-1], agg.es$att.egt))
## MATPLOT of
matplot(cbind(simdf$b3[simdf$actor==60][-1], agg.es$att.egt), type='o',pch=1:2)
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd-1)]))
endog <- data.frame(threshold=c(1/2, 1/3,1/4,1/5,1/6),cor=c(-0.2523,-.2030,-.2086,-.2107,-.2214))
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd+1)]))
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd-1)]))
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd-0)]))
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd-1)]))
endog <- data.frame(threshold=c(1/2, 1/3,1/4,1/5,1/6),
cor=c(-0.2523,-.2030,-.2086,-.2107,-.2214))
edog
endog
# library(dplyr)
simdf <- simlist$`1.no.perf.no.gro`$sim$df
simdf <- simdf[which(simdf$effect.type=='quadratic'), ]
## Set group name 'gname' field, where 0 = control, # = period of treatment
simdf$gname <- 0
simdf$gname[simdf$group=='treatment'] <- simdf$match_pd[simdf$group=='treatment']
ccattgt <- att_gt(yname = "y", ## "Y",
tname = "t",
idname = "actor",
gname = "gname",
xformla = ~x1 + x2 + x3 + c1 + c2 + c3,
data = simdf #,
# panel = F
)
ccattgt
agg.simple <- aggte(ccattgt, type='simple')
summary(agg.simple)
## DYNAMIC EFFECTS AND EVENT STUDIES
agg.es <- aggte(ccattgt, type = "dynamic")
summary(agg.es)
ggdid(agg.es)
## Correlation of simulated to inferred
cor(cbind(simdf$b3[simdf$actor==1][-1], agg.es$att.egt))
## MATPLOT of
matplot(cbind(simdf$b3[simdf$actor==60][-1], agg.es$att.egt), type='o',pch=1:2)
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd-1)]))
endog <- data.frame(threshold=c(1/2, 1/3,1/4,1/5,1/6),
cor=c(-0.2523,-.2030,-.2086,-.2107,-.2214))
ccattgt
agg.simple <- aggte(ccattgt, type='simple')
head(simdf)
ccattgt <- att_gt(yname = "y", ## "Y",
tname = "t",
idname = "actor",
gname = "gname",
xformla = ~c1 + c2 + c3,
data = simdf #,
# panel = F
)
ccattgt
agg.simple <- aggte(ccattgt, type='simple')
summary(agg.simple)
## DYNAMIC EFFECTS AND EVENT STUDIES
agg.es <- aggte(ccattgt, type = "dynamic")
summary(agg.es)
ggdid(agg.es)
## Run Simulation List
sim.id <- round(as.numeric(Sys.time()))
for (i in 1:length(simlist)) {
key <- names(simlist)[i]
sim <- simlist[[key]]
cat(sprintf('\nScenario label: %s\n\n', key))
# cat(str(simlist[[key]]))
simlist[[key]]$sim <- runSimSingleInterventionEffectComparison(
n = n, ## NUMBER OF FIRMS
npds = npds, ## NUMBER OF PERIODS
intpd = intpd, ## intervention after first section
ystart = 0,
effect.types = effect.types,
# benchmark.type = 'self', ## 'all', 'self'
# treat.rule = 'random',
treat.rule = 'below.benchmark',
treat.prob = .95, #0.95,  ## 0.6
treat.threshold = 1/3,  # 0.015
sim.id = sim.id, ## defaults to timestamp
##
b4 = sim$b4, ## past performance
b5 = sim$b5, ## growth (linear function of time t)
## Dynamic treatment effect function parameters
w0 = 1.7,  ## constant
w1 = 0.18,  ## linear
w2 = -0.005,  ## quadratic
## TODO: CHECK w2.shift SENSITIVITY - this shifts quadratic curve several periods to the right so that treatment effect increases slowly
w2.shift = -round(.3*intpd),  ## optimal value here is likely a function of the combination of treatment effect function parameters
## Plotting
plot.show=F, ## TRUE
plot.save=F  ## TRUE
)
}
## Save simulation list as serialized data file
simlist.file <- sprintf('single_intervention_SIMLIST_%s.rds', simlist[[1]]$sim$id)
saveRDS(simlist, file = file.path(dir_plot, simlist.file))
##====================
##  DEBUG
##--------------
View(simlist$`3.mi.perf.lo.gro`$sim$df)
library(tibble)
library(did)
# library(dplyr)
simdf <- simlist$`1.no.perf.no.gro`$sim$df
simdf <- simdf[which(simdf$effect.type=='quadratic'), ]
## Set group name 'gname' field, where 0 = control, # = period of treatment
simdf$gname <- 0
simdf$gname[simdf$group=='treatment'] <- simdf$match_pd[simdf$group=='treatment']
ccattgt <- att_gt(yname = "y", ## "Y",
tname = "t",
idname = "actor",
gname = "gname",
xformla = ~c1 + c2 + c3,
data = simdf #,
# panel = F
)
ccattgt
agg.simple <- aggte(ccattgt, type='simple')
summary(agg.simple)
## DYNAMIC EFFECTS AND EVENT STUDIES
agg.es <- aggte(ccattgt, type = "dynamic")
summary(agg.es)
ggdid(agg.es)
## Correlation of simulated to inferred
cor(cbind(simdf$b3[simdf$actor==1][-1], agg.es$att.egt))
## MATPLOT of
matplot(cbind(simdf$b3[simdf$actor==60][-1], agg.es$att.egt), type='o',pch=1:2)
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd-1)]))
endog <- data.frame(threshold=c(1/2, 1/3,1/4,1/5,1/6),
cor=c(-0.2523,-.2030,-.2086,-.2107,-.2214))
## Run Simulation List
sim.id <- round(as.numeric(Sys.time()))
for (i in 1:length(simlist)) {
key <- names(simlist)[i]
sim <- simlist[[key]]
cat(sprintf('\nScenario label: %s\n\n', key))
# cat(str(simlist[[key]]))
simlist[[key]]$sim <- runSimSingleInterventionEffectComparison(
n = n, ## NUMBER OF FIRMS
npds = npds, ## NUMBER OF PERIODS
intpd = intpd, ## intervention after first section
ystart = 0,
effect.types = effect.types,
# benchmark.type = 'self', ## 'all', 'self'
# treat.rule = 'random',
treat.rule = 'below.benchmark',
treat.prob = .95, #0.95,  ## 0.6
treat.threshold = 1/3,  # 0.015
sim.id = sim.id, ## defaults to timestamp
##
b4 = sim$b4, ## past performance
b5 = sim$b5, ## growth (linear function of time t)
## Dynamic treatment effect function parameters
w0 = 1.7,  ## constant
w1 = 0.18,  ## linear
w2 = -0.005,  ## quadratic
## TODO: CHECK w2.shift SENSITIVITY - this shifts quadratic curve several periods to the right so that treatment effect increases slowly
w2.shift = -round(.4*intpd),  ## optimal value here is likely a function of the combination of treatment effect function parameters
## Plotting
plot.show=T, ## TRUE
plot.save=T  ## TRUE
)
}
## Save simulation list as serialized data file
simlist.file <- sprintf('single_intervention_SIMLIST_%s.rds', simlist[[1]]$sim$id)
saveRDS(simlist, file = file.path(dir_plot, simlist.file))
##====================
##  DEBUG
##--------------
View(simlist$`3.mi.perf.lo.gro`$sim$df)
library(tibble)
library(did)
# library(dplyr)
simdf <- simlist$`1.no.perf.no.gro`$sim$df
simdf <- simdf[which(simdf$effect.type=='quadratic'), ]
## Set group name 'gname' field, where 0 = control, # = period of treatment
simdf$gname <- 0
simdf$gname[simdf$group=='treatment'] <- simdf$match_pd[simdf$group=='treatment']
ccattgt <- att_gt(yname = "y", ## "Y",
tname = "t",
idname = "actor",
gname = "gname",
xformla = ~c1 + c2 + c3,
data = simdf #,
# panel = F
)
ccattgt
agg.simple <- aggte(ccattgt, type='simple')
summary(agg.simple)
## DYNAMIC EFFECTS AND EVENT STUDIES
agg.es <- aggte(ccattgt, type = "dynamic")
summary(agg.es)
ggdid(agg.es)
## Correlation of simulated to inferred
cor(cbind(simdf$b3[simdf$actor==1][-1], agg.es$att.egt))
## MATPLOT of
matplot(cbind(simdf$b3[simdf$actor==60][-1], agg.es$att.egt), type='o',pch=1:2)
cor(cbind(simdf$x1[simdf$t==intpd], simdf$y[simdf$t==(intpd-1)]))
endog <- data.frame(threshold=c(1/2, 1/3,1/4,1/5,1/6),
cor=c(-0.2523,-.2030,-.2086,-.2107,-.2214))
## MATPLOT of
matplot(cbind(simdf$b3[simdf$actor==60][-1], agg.es$att.egt), type='o',pch=1:2)
library(bsts)
data(iclaims)
ss <- AddLocalLinearTrend(list(), initial.claims$iclaimsNSA)
ss <- AddSeasonal(ss, initial.claims$iclaimsNSA, nseasons = 52)
model1 <- bsts(initial.claims$iclaimsNSA,
state.specification = ss,
niter = 1000)
## CALENDAR TIME EFFECT
agg.ca <- aggte(ccattgt, type = "calendar")
summary(agg.ca)
ggdid(agg.ca)
agg.simple <- aggte(ccattgt, type='simple')
summary(agg.simple)
